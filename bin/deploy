#!/bin/bash

FTOPIC="automodel-event"

FVAR="PID=${GCP_PROJECT}"
FVAR="${FVAR},METRIC_SRC_ID_PATH=source_id"
FVAR="${FVAR},METRIC_VALUE_PATH=cpu_used"
FVAR="${FVAR},METRIC_TIME_PATH=event_ts"
FVAR="${FVAR},METRIC_TYPE=custom.googleapis.com/metric/friction"

gcloud functions deploy custommetrics-maker \
  --entry-point ProcessorMetric \
  --set-env-vars $FVARS \
  --memory 256MB \
  --region us-central1 \
  --runtime go112 \
  --trigger-topic $FTOPIC \
  --timeout 540s
