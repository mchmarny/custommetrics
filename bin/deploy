#!/bin/bash

FVARS="PID=${GCP_PROJECT},METRIC_SRC_ID_PATH=source_id,METRIC_VALUE_PATH=cpu_used,METRIC_TIME_PATH=event_ts,METRIC_TYPE=custom.googleapis.com/metric/friction"

gcloud functions deploy custommetrics-maker \
  --entry-point ProcessorMetric \
  --set-env-vars $FVARS \
  --memory 256MB \
  --region us-central1 \
  --runtime go112 \
  --trigger-topic automodel-event \
  --timeout 300s
