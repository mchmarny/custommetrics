#!/bin/bash

FTOPIC="automodel-event"

FVAR="METRIC_TYPE=custom.googleapis.com/metric/friction"
FVAR+=",METRIC_SRC_ID=source_id"
FVAR+=",METRIC_VALUE=cpu_used"
FVAR+=",METRIC_TIME=event_ts"

gcloud functions deploy custommetrics-maker \
  --entry-point ProcessorMetric \
  --set-env-vars=$FVARS \
  --memory 256MB \
  --region us-central1 \
  --runtime go112 \
  --trigger-topic $FTOPIC \
  --timeout 540s
